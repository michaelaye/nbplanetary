---

title: Utils


keywords: fastai
sidebar: home_sidebar

summary: "General utilities. Should probably split up into `utils.time` and `utils.download`"
description: "General utilities. Should probably split up into `utils.time` and `utils.download`"
nb_path: "notebooks/01_utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: notebooks/01_utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Time-format-strings">Time format strings<a class="anchor-link" href="#Time-format-strings"> </a></h2><p>These are the different format strings these utils convert from and to.</p>
<p>An identifier with <code>_dt_</code> in its name signifies a full <code>datetime</code> format as compared to dates only.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="nasa_date_to_iso" class="doc_header"><code>nasa_date_to_iso</code><a href="https://github.com/michaelaye/nbplanetarypy/tree/{branch}/planetarypy/utils.py#L41" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>nasa_date_to_iso</code>(<strong><code>datestr</code></strong>, <strong><code>with_hours</code></strong>=<em><code>False</code></em>)</p>
</blockquote>

<pre><code>Convert the day-number based NASA date format to ISO.

Parameters
----------
datestr : str
    Date string in the form Y-j

Returns
-------
Datestring in ISO standard yyyy-mm-ddTHH:MM:SS.MMMMMM</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nasa_date</span> <span class="o">=</span> <span class="s2">&quot;2010-110&quot;</span>
<span class="n">iso_date</span> <span class="o">=</span> <span class="s2">&quot;2010-4-20&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">nasa_date_to_iso</span><span class="p">(</span><span class="n">nasa_date</span><span class="p">,</span> <span class="n">with_hours</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;2010-04-20T00:00:00&quot;</span>
<span class="k">assert</span> <span class="n">nasa_date_to_iso</span><span class="p">(</span><span class="n">nasa_date</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;2010-04-20&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="iso_to_nasa_date" class="doc_header"><code>iso_to_nasa_date</code><a href="https://github.com/michaelaye/nbplanetarypy/tree/{branch}/planetarypy/utils.py#L60" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>iso_to_nasa_date</code>(<strong><code>datestr</code></strong>)</p>
</blockquote>

<pre><code>Convert iso date to day-number based NASA date.

Parameters
----------
datestr : str
    Date string in the form Y-m-d

Returns
-------
Datestring in NASA standard yyyy-jjj</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">iso_to_nasa_date</span><span class="p">(</span><span class="n">iso_date</span><span class="p">)</span> <span class="o">==</span> <span class="n">nasa_date</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="nasa_datetime_to_iso" class="doc_header"><code>nasa_datetime_to_iso</code><a href="https://github.com/michaelaye/nbplanetarypy/tree/{branch}/planetarypy/utils.py#L76" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>nasa_datetime_to_iso</code>(<strong><code>dtimestr</code></strong>)</p>
</blockquote>

<pre><code>Convert the day-number based NASA datetime format to ISO.

Note: This is dateTIME vs `nasa_date_to_iso` which is just DATE.

Parameters
----------
dtimestr : str
    Datetime string in the form Y-jTH:M:S

Returns
-------
Datestring in ISO standard yyyy-mm-ddTHH:MM:SS.MMMMMM</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nasa_datetime</span> <span class="o">=</span> <span class="s2">&quot;2010-110T10:12:14&quot;</span>
<span class="n">nasa_datetime_with_ms</span> <span class="o">=</span> <span class="n">nasa_datetime</span> <span class="o">+</span> <span class="s2">&quot;.123000&quot;</span>
<span class="n">iso_datetime</span> <span class="o">=</span> <span class="s2">&quot;2010-04-20T10:12:14&quot;</span>
<span class="n">iso_datetime_with_ms</span> <span class="o">=</span> <span class="n">iso_datetime</span> <span class="o">+</span> <span class="s2">&quot;.123000&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">nasa_datetime_to_iso</span><span class="p">(</span><span class="n">nasa_datetime</span><span class="p">)</span> <span class="o">==</span> <span class="n">iso_datetime</span>
<span class="k">assert</span> <span class="n">nasa_datetime_to_iso</span><span class="p">(</span><span class="n">nasa_datetime_with_ms</span><span class="p">)</span> <span class="o">==</span> <span class="n">iso_datetime_with_ms</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="iso_to_nasa_datetime" class="doc_header"><code>iso_to_nasa_datetime</code><a href="https://github.com/michaelaye/nbplanetarypy/tree/{branch}/planetarypy/utils.py#L100" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>iso_to_nasa_datetime</code>(<strong><code>dtimestr</code></strong>)</p>
</blockquote>

<pre><code>Convert iso datetime to day-number based NASA datetime.

Parameters
----------
dtimestr : str
    Datetime string in the form yyyy-mm-ddTHH-MM-SS

Returns
-------
Datestring in NASA standard yyyy-jjjTHH-MM-SS</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">iso_to_nasa_datetime</span><span class="p">(</span><span class="n">iso_datetime</span><span class="p">)</span> <span class="o">==</span> <span class="n">nasa_datetime</span>
<span class="k">assert</span> <span class="n">iso_to_nasa_datetime</span><span class="p">(</span><span class="n">iso_datetime_with_ms</span><span class="p">)</span> <span class="o">==</span> <span class="n">nasa_datetime_with_ms</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="replace_all_nasa_times" class="doc_header"><code>replace_all_nasa_times</code><a href="https://github.com/michaelaye/nbplanetarypy/tree/{branch}/planetarypy/utils.py#L125" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>replace_all_nasa_times</code>(<strong><code>df</code></strong>)</p>
</blockquote>

<pre><code>Find all NASA times in dataframe and replace with ISO.

Changes will be implemented on incoming dataframe!

This will be done for all columns with the word TIME in the column name.

Parameters
----------
df: pandas.DataFrame
    DataFrame with NASA time columns.

Returns
-------
Nothing (Changes implemented in-place)</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Network-utils">Network utils<a class="anchor-link" href="#Network-utils"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ProgressBar" class="doc_header"><code>class</code> <code>ProgressBar</code><a href="https://github.com/michaelaye/nbplanetarypy/tree/{branch}/planetarypy/utils.py#L148" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ProgressBar</code>(<strong>*<code>_</code></strong>, <strong>**<code>__</code></strong>) :: <code>tqdm</code></p>
</blockquote>

<pre><code>Provides `update_to(n)` which uses `tqdm.update(delta_n)`.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="parse_http_date" class="doc_header"><code>parse_http_date</code><a href="https://github.com/michaelaye/nbplanetarypy/tree/{branch}/planetarypy/utils.py#L165" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>parse_http_date</code>(<strong><code>text</code></strong>)</p>
</blockquote>

<pre><code>Parse date string retrieved via urllib.request.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_remote_timestamp" class="doc_header"><code>get_remote_timestamp</code><a href="https://github.com/michaelaye/nbplanetarypy/tree/{branch}/planetarypy/utils.py#L170" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_remote_timestamp</code>(<strong><code>url</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="download" class="doc_header"><code>download</code><a href="https://github.com/michaelaye/nbplanetarypy/tree/{branch}/planetarypy/utils.py#L177" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>download</code>(<strong><code>url</code></strong>, <strong><code>local_dir</code></strong>=<em><code>'.'</code></em>, <strong><code>use_tqdm</code></strong>=<em><code>True</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>

<pre><code>Simple wrapper of urlretrieve

Adding a default path to urlretrieve

Parameters:
----------
url : str
    HTTP(S) URL to download
local_dir : str,pathlib.Path
    Local directory where to store the download.
**kwargs : {dict}
    Keyword args to be handed to urlretrieve.
Returns
-------
Tuple
    Tuple returned by urlretrieve</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="url_retrieve" class="doc_header"><code>url_retrieve</code><a href="https://github.com/michaelaye/nbplanetarypy/tree/{branch}/planetarypy/utils.py#L208" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>url_retrieve</code>(<strong><code>url</code></strong>:<code>str</code>, <strong><code>outfile</code></strong>:<code>str</code>, <strong><code>chunk_size</code></strong>:<code>int</code>=<em><code>128</code></em>)</p>
</blockquote>

<pre><code>Improved urlretrieve with progressbar, timeout and chunker.

This downloader has built-in progress bar using tqdm and using the `requests`
package it improves standard `urllib` behavior by adding time-out capability.

I tested different chunk_sizes and most of the time 128 was actually fastest, YMMV.

Parameters
----------
url : str, urlpath.URL
    The URL to download
outfile: str, pathlib.Path
    The path where to store the downloaded file.
chunk_size : int, optional
    The size of the chunk for the request.iter_content call. Default: 128

See also
--------
Inspired by https://stackoverflow.com/a/61575758/680232</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Image-processing-helpers">Image processing helpers<a class="anchor-link" href="#Image-processing-helpers"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="height_from_shadow" class="doc_header"><code>height_from_shadow</code><a href="https://github.com/michaelaye/nbplanetarypy/tree/{branch}/planetarypy/utils.py#L244" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>height_from_shadow</code>(<strong><code>shadow_in_pixels</code></strong>, <strong><code>sun_elev</code></strong>)</p>
</blockquote>

<pre><code>Calculate height of an object from its shadow length.

Note, that your image might have been binned.
You need to correct `shadow_in_pixels` for that.

Parameters
----------
shadow_in_pixels : float
    Measured length of shadow in pixels
sun_elev : angle(float)
    Angle of sun over horizon

Returns
-------
height [meter]</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_gdal_center_coords" class="doc_header"><code>get_gdal_center_coords</code><a href="https://github.com/michaelaye/nbplanetarypy/tree/{branch}/planetarypy/utils.py#L266" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_gdal_center_coords</code>(<strong><code>imgpath</code></strong>)</p>
</blockquote>

<pre><code>Get center rows/cols pixel coordinate for GDAL-readable dataset.

Check CLI `gdalinfo --formats` to see all formats that GDAL can open.

Parameters
----------
imgpath: str, pathlib.Path
    Path to raster image that is readable by GDLA</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="file_variations" class="doc_header"><code>file_variations</code><a href="https://github.com/michaelaye/nbplanetarypy/tree/{branch}/planetarypy/utils.py#L285" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>file_variations</code>(<strong><code>filename</code></strong>, <strong><code>extensions</code></strong>)</p>
</blockquote>

<pre><code>Create a variation of file names.

Generate a list of variations on a filename by replacing the extension with
the provided list.

Parameters
----------
filename: str, pathlib.Path
    The original file name to use as a base.
extensions: list-like
    A list of file extensions to generate new filenames.

Returns
-------
list of pathlib.Paths

Notes
-----
Adapted from T. Olsens `file_variations of the pysis module for using pathlib.</code></pre>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;abc.txt&#39;</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">extensions</span> <span class="o">=</span> <span class="s2">&quot;.cub .cal.cub .map.cal.cub&quot;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">file_variations</span><span class="p">(</span><span class="n">fname</span><span class="p">,</span> <span class="n">extensions</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[PosixPath(&#39;abc.cub&#39;), PosixPath(&#39;abc.cal.cub&#39;), PosixPath(&#39;abc.map.cal.cub&#39;)]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

